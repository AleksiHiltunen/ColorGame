<!doctype html>
	<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fi" lang="fi">
	<head>
			<meta charset="utf-8">
			<title>Color Game</title>
			<meta http-equiv="X-UA-Compatible" content="IE=edge" />
			<meta content='width=1280, user-scalable=0' name='viewport' />
			<script src="/libs/qimessaging/1.0/qimessaging.js"></script>
		
	<link href="https://fonts.googleapis.com/css?family=Abril+Fatface|Ubuntu" rel="stylesheet"> 
		
		<link rel="apple-touch-icon" sizes="57x57" href="<?= SITEPATH ?>img/ico/apple-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="<?= SITEPATH ?>img/ico/apple-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="<?= SITEPATH ?>img/ico/apple-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="<?= SITEPATH ?>img/ico/apple-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="<?= SITEPATH ?>img/ico/apple-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="<?= SITEPATH ?>img/ico/apple-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="<?= SITEPATH ?>img/ico/apple-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="<?= SITEPATH ?>img/ico/apple-icon-152x152.png">
		<link rel="apple-touch-icon" sizes="180x180" href="<?= SITEPATH ?>img/ico/apple-icon-180x180.png">
		<link rel="icon" type="image/png" sizes="192x192"  href="<?= SITEPATH ?>img/ico/android-icon-192x192.png">
		<link rel="icon" type="image/png" sizes="32x32" href="<?= SITEPATH ?>img/ico/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="96x96" href="<?= SITEPATH ?>img/ico/favicon-96x96.png">
		<link rel="icon" type="image/png" sizes="16x16" href="<?= SITEPATH ?>img/ico/favicon-16x16.png">
		<link rel="manifest" href="<?= SITEPATH ?>img/ico/manifest.json">


		<link href="site/css/bootstrap.min.css" rel="stylesheet" type="text/css">
		<link href="site/css/style.css" rel="stylesheet" type="text/css">	
		<script src="https://code.jquery.com/jquery-1.11.1.min.js"</script>
		<script src="site/js/bootstrap.min.js"></script>
		<link href="site/web-fonts-with-css/css/fontawesome-all.min.css" rel="stylesheet">
		
		<style>
			.rainbow {
				background-image: -webkit-gradient( linear, left top, right top, color-stop(0, #f22), color-stop(0.15, #f2f), color-stop(0.3, #22f), color-stop(0.45, #2ff), color-stop(0.6, #2f2),color-stop(0.75, #2f2), color-stop(0.9, #ff2), color-stop(1, #f22) );
				background-image: gradient( linear, left top, right top, color-stop(0, #f22), color-stop(0.15, #f2f), color-stop(0.3, #22f), color-stop(0.45, #2ff), color-stop(0.6, #2f2),color-stop(0.75, #2f2), color-stop(0.9, #ff2), color-stop(1, #f22) );
				color:transparent;
				-webkit-background-clip: text;
				background-clip: text;
			}
			input[type=text]{
				color: black;
			}
			.row{
				color:black;
			}
		</style>
	</head>
	

<body style="medium-top-padding">
	<div class="container">
		<div class="row">
			<h1 id="title" class="rainbow">Color Game</h1>
		</div>
		<div class="row" id="player_container">
			<div class="row" style="color:black">First let me know your names by inserting your names on the text fields below</div>
			<div class="col-sm-4">
				<a>Player 1</a><br>
				<input type="text" id="player1"/>
			</div>
			<div class="col-sm-15">
				<a>Player 2</a><br>
				<input type="text" id="player2"/>
			</div>
			<div class="row">
				<button onclick="start_clicked()" id="start_btn" href="players.html">Continue</button>
			</div>
		</div>
		<div class="row" id="statement_container" style="display:none">
			<h2 id="instruction"></h2>
			<div class="row col-sm-5">
				<ul id="statements" style="text-align:left">
					<li>My occupation is...</li>
					<li>I work at...</li>
					<li>I am from...</li>
					<li>My research field/interest is...</li>
					<li>What I enjoy most about my job is...</li>
					<li>My hobby is...</li>
					<li>The highlight of the day was...</li>
					<li>My educational background is...</li>
					<li>I am here today to...</li>
					<li>I like to travel to...</li>
				</ul>
			</div>
		</div>
		<div class="row col-sm-3" id="timer" style="display:none"></div>
		<div class="row col-sm-10" id="skip_btn"><a  onclick="colorPick()">Skip</a></div>
		<div class="row" id="pick_instruction" style="display:none"></div>
		<div class="row col-sm-2" id="player1_selection" style="display:none;border-style:solid;border-color:black;border-width:medium;height:90%" ondrop="drop1(event)" ondragover="allowDrop(event)">
			<p style="color:black" id="player1_selection_text"></p>
		</div>
		<div class="row col-sm-8" id="color_btns" style="display:none">
			<a id="orange" class="link-round color-orange whiteoutline box-shadow text-center " draggable="true" ondragstart="drag(event)" >
				<h3>Orange</h3>
			</a>
			<a id="yellow" class="link-round color-yellow whiteoutline box-shadow text-center " draggable="true" ondragstart="drag(event)">
				<h3>Yellow</h3>
			</a>
			<a id="blue" class="link-round color-blue whiteoutline box-shadow text-center " draggable="true" ondragstart="drag(event)">
				<h3>Blue</h3>
			</a>
			<a id="pink" class="link-round color-pink whiteoutline box-shadow text-center " draggable="true" ondragstart="drag(event)">
				<h3>Pink</h3>
			</a><br>
			<a id="green" class="link-round color-green whiteoutline box-shadow text-center " draggable="true" ondragstart="drag(event)">
				<h3>Green</h3>
			</a>
			<a id="brown" class="link-round color-brown whiteoutline box-shadow text-center " draggable="true" ondragstart="drag(event)">
				<h3>Brown</h3>
			</a>
			<a id="purple" class="link-round color-purple whiteoutline box-shadow text-center " draggable="true" ondragstart="drag(event)">
				<h3>Purple</h3>
			</a>
			<a id="red" class="link-round color-red whiteoutline box-shadow text-center " draggable="true" ondragstart="drag(event)">
				<h3>Red</h3>
			</a><br>
			<a id="olive" class="link-round color-olive whiteoutline box-shadow text-center " draggable="true" ondragstart="drag(event)">
				<h3>Olive</h3>
			</a>
			<a id="lime" class="link-round color-lime whiteoutline box-shadow text-center " draggable="true" ondragstart="drag(event)">
				<h3>Lime</h3>
			</a>
		</div>
		<div class="row col-sm-2" id="player2_selection" style="display:none;border-style:solid;border-color:black;border-width:medium;height:90%" ondrop="drop2(event)" ondragover="allowDrop(event)">
			<p style="color:black" id="player2_selection_text"></p>
		</div>
		
		<div id="question_container" class="row" style="display:none">
			<h2 id="current_question" class="row">CURRENT QUESTION</h2>
			<div id="ans_buttons">
				<a id="yes" onclick="ans_clicked(1)" class="link-round color-green whiteoutline box-shadow text-center "><h3>Yes</h3></a>
				<a id="no" onclick="ans_clicked(0)" class="link-round color-red whiteoutline box-shadow text-center "><h3>No</h3></a>
			</div>
		</div>
	</div>
	
	
	<script>
		//var session = new QiSession();
		var timer_;					//Timer variable in the presentation phase
		var statement_timer = 0;	
		var player1, player2;		//Players' names
		var player1_colors = [];	//Player1 picked colors
		var player2_colors = [];	//Player2 picked colors
		var _dragged = "";			//global variable for dragged item
		var player_turn = 1;		
		var player1_points = 0;
		var player2_points = 0;
		
		var question_refs = {	
								"red":"What was my occupation?",
								"green":"Which place would I like to travel to?",
								"blue":"What is my educational background?",
								"orange":"What do I enjoy the most in my job?",
								"purple":"What is the reason for my attendance in this event?",
								"pink":"What is my research field?",
								"yellow":"Where do I work?",
								"brown":"What is my hobby/hobbies?",
								"olive":"Where am I from?",
								"lime":"What is/was the highlight of my day?"
							}
		
		function start_clicked(){
			player1 = document.getElementById("player1").value;
			player2 = document.getElementById("player2").value;
			
			if(player1 == ""){
				console.log("Invalid Player1 name inserted....");
				return;
			}
			if(player2 == ""){
				console.log("Invalid Player2 name inserted....");
				return;
			}

			display_instructions();
		}
		
		function display_instructions(){
			document.getElementById("player_container").style = "display:none";
			document.getElementById("statement_container").style = "display:block";
			document.getElementById("instruction").innerText  = player1 + " please start completing these statements: ";
			//PEPPER SPEAKS AND AFTER HE HAS COMPLETED HIS STATEMENT SENDS A SIGNAL THAT STARTS THE TIMER
			startTimer(10, document.getElementById("timer"));
		}
		
		function startTimer(duration, display) {
			var timer = duration, minutes, seconds;
			document.getElementById("timer").style = "display:block";
			console.log("displaying timer");
			timer_ = setInterval(function () {
				++statement_timer;
				if(statement_timer == 11){
					timer = duration, minutes, seconds;
					document.getElementById("instruction").innerText  = player2 + " please start completing these statements: ";
				}
				if(statement_timer == 21){
					colorPick();
				}
				minutes = parseInt(timer / 60, 10)
				seconds = parseInt(timer % 60, 10);

				minutes = minutes < 10 ? "0" + minutes : minutes;
				seconds = seconds < 10 ? "0" + seconds : seconds;

				display.textContent = minutes + ":" + seconds;

				if (--timer < 0) {
					stopTimer(display);
					clearInterval(timer_);
				}
			}, 1000);
		}
		
		function stopTimer(display){
			display.style.display = "none";
			clearInterval(timer_);
		}
		
		function colorPick(){
			document.getElementById("instruction").innerText  = player1 + " please start completing these statements: ";
			stopTimer(document.getElementById("timer"));
			document.getElementById("statement_container").style.display = "none";
			document.getElementById("color_btns").style.display = "block";

			document.getElementById("skip_btn").style.display = "none";
			document.getElementById("player1_selection").style = "display:block;border-style:solid;border-color:black;border-width:medium;height:600px";
			document.getElementById("player2_selection").style = "display:block;border-style:solid;border-color:black;border-width:medium;height:600px";
			document.getElementById("player1_selection_text").innerText = player1;
			document.getElementById("player2_selection_text").innerText = player2;
		}
		
		/*session.service("ALMemory").then(function (ALMemory) {
			ALMemory.subscriber("colorgame/starttimer").then(function (subscriber) {
				subscriber.signal.connect(function (state) {
					startTimer(10, document.getElementById("timer"));
				});
			});
		})*/
		function allowDrop(ev) {
			ev.preventDefault();
		}
		function drag(ev) {
			_dragged = ev.target.id;
			ev.dataTransfer.setData("text", ev.target.id);
			console.log("dragging", ev);
		}
		function drop1(ev) {
			ev.preventDefault();
			if(player1_colors.length == 5){
				console.log(num_player1_colors, "should not be able to drop here");
				document.getElementById("player1_selection").ondragoover = function(){return;};
				document.getElementById("player1_selection").ondrop = function(){return false;};
			}
			else{
				player1_colors.push(_dragged);
				stuff(ev);
				console.log("Dropping to player 1");
			}
		}
		function drop2(ev) {
			ev.preventDefault();
			if(player2_colors.length == 5){
				console.log(num_player2_colors, "should not be able to drop here");
				document.getElementById("player2_selection").ondragoover = function(){return;};
				document.getElementById("player2_selection").ondrop = function(){return false;};
			}
			else{
				player2_colors.push(_dragged);
				stuff(ev);
				console.log("Dropping to player 2");
			}	
		}
		
		function stuff(ev){
			console.log("Player 1 colors are now:", player1_colors);
			console.log("Player 2 colors are now:", player2_colors);
			var data = ev.dataTransfer.getData("text");
			ev.target.appendChild(document.getElementById(data));
			ev.target.setAttribute('draggable',false);
			if(player1_colors.length == 5 && player2_colors.length == 5){
				//Proceed to the questions part
				//TODO SEND SINGAL FOR PERPPER TO START EXPLAINING THE MEANING OF COLORS
				//"Each color is associated with a question about the other player, so let's begin the game."
				
				questions();
			}
		}
		
		function questions(){
			document.getElementById("player1_selection").style.display = "none";
			document.getElementById("player2_selection").style.display = "none";
			document.getElementById("color_btns").style.display = "none";
			document.getElementById("question_container").style.display = "block";
			document.getElementById("current_question").innerText = question_refs[player1_colors[0]];
		}
		
		function ans_clicked(ans){
			if(player_turn == 1){
				player2_points += ans;
				player_turn = 2;
				//Raise signal for Pepper to say correct/false
				player1_colors.shift();
				document.getElementById("current_question").innerText = question_refs[player2_colors[0]];
			}
			else if(player_turn == 2){
				player1_points += ans;
				player_turn = 1
				//Raise signal for Pepper to say correct/false
				player2_colors.shift();
				document.getElementById("current_question").innerText = question_refs[player1_colors[0]];
			}
			if(player2_colors.length == 0){
				console.log("END GAME");
				document.getElementById("current_question").innerText = player1 + " got " + player1_points + " points!\n" + player2 + " got " + player2_points + " points!\n\nEnjoy the event!";
				document.getElementById("ans_buttons").style.display = "none";
			}
			
		}
		
	</script>
</body>
</html>
